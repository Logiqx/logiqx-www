<!DOCTYPE html PUBLIC "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
  <meta http-equiv="Content-Type"
 content="text/html; charset=iso-8859-1">
  <meta name="Author" content="Pi">
  <meta name="GENERATOR"
 content="Mozilla/4.78 [es] (Windows NT 5.0; U) [Netscape]">
  <title>Altering Pickin' Color PROMS</title>
</head>
<body text="#000000" bgcolor="#999999" link="#0000ee" vlink="#551a8b"
 alink="#ff0000">
<div style="text-align: center;">
<table
 style="width: 600px; text-align: left; margin-left: auto; margin-right: auto;"
 border="0" cellspacing="2" cellpadding="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;"><br>
      <br>
      <table border="1" cols="2"
 style="background-color: rgb(192, 192, 192); width: 35%; text-align: left; margin-right: auto; margin-left: auto;">
        <tbody>
          <tr>
            <td rowspan="1">
            <center><br>
            <big style="font-weight: bold;"><big>Altering Pickin's
Color PROMS</big></big><br>
            <br>
            </center>
            </td>
          </tr>
        </tbody>
      </table>
      <div style="text-align: center;"><br>
      <br>
      <br>
      </div>
About 1983 or 1984, I saw in an arcade a machine with simple graphics.
The object of the game was moving colored squares into the
corresponding colored boxes. However, in the first level the colors
were light green, yellow and blue. The problem was that I couldn't
distinguish the light green and yellow, so I couldn't play that game. I
was about 11 or 12 years old, and until I was 18 I didn't know I had a
problem perceiving colors called Chronic Educational Daltonism.<br>
      <br>
Then about year 2000 I was happily playing with MAME and investigating
new games when I saw this game again, 16 years later. It turned out to
be <a href="http://caesar.logiqx.com/html/emus/multi/mame/pickin.shtml">Pickin'
(Valadon Automation, 1983)</a>. Of course I was delighted to have
rediscovered another game from my youth, or rather a frustration. I
liked the game concept but I couldn't play anyway. So again I parked
the game in a little corner of the back of my mind.<br>
      <br>
In February 2004 (past week) I was making a list of my favorite arcade
games in MAME32, and I decided that Pickin' should be there. And again
the frustration of not being able to play it long enough to even know
if I really like the game. So I went to a board and asked for a quick
color hack. Dave Widel helped me to change one of the colors, and for
the first time in my life, 20 years later, I was able to pass the first
level of the game!<br>
      <br>
It turned out that later levels had more boxes, up to nine. And there
were nine colors. If you let the attract mode run by itself, the third
demo game will contain nine different colored boxes:<br>
&nbsp;
      <center>
      <table border="1" cols="2"
 style="background-color: rgb(192, 192, 192); width: 35%;">
        <tbody>
          <tr>
            <td rowspan="1">
            <center><br>
            <img style="width: 224px; height: 256px;"
 alt="Pickin's third demo" title="Pickin's third demo"
 src="pickin.png"><br>
            <br>
            </center>
            </td>
          </tr>
        </tbody>
      </table>
      <br>
      <div style="text-align: left;">Note that the boxes are actually
outlined. I filled them to make the colors more noticeable. I'll refer
to the boxes in a row/columns fashion, so R1C1 is the top left yellow,
and R3C2 is the bottom-center bright red. So far I can't distinguish
the R1C1 yellow from the R2C1 bright green, and I can't distinguish
either two of the blues R3C1 and R3C3. When outlined, I have probs with
R1C3 and R2C3 too (greenish and brown). I can distinguish them but not
at first sight.<br>
      <br>
So I started to investigate how to change the colors to something I
could play with ^_^ I had only one information: changing byte 5 of prom
6331-1.3p from 3F to 05 would change the yellow box into red. So now I
had to discover two things: which bytes in the color proms defined each
of the color boxes, and how the color was encoded in each byte so I
could specify my own colors.<br>
      <br>
First I tried to locate more bytes which when altered, would change the
color of the boxes. The proms look quite strange inside: the even bytes
are alternatively 00 and FF, and the colors are only the odd bytes. I
knew that one color was in byte 5. After some tests, it turned out that
the bytes used for boxes are also alterned. I located the bytes for
boxes R1C1, R2C1, R3C1 and R1C2 at bytes 5, 9, 13 and 17. I hope you
see the pattern... ^_^<br>
      <br>
Then, before going for the remaining boxes (easy) I had to work out how
a byte is transformed into a color. I have to say I was lost in here,
so I did something I should have done from the very beginning: look at
the source for some notes. Pickin' is in the Bagman driver. I found
this in vidhdrw/bagman.c: <br>
      <br>
      <br>
      </div>
      </center>
      <center>
      <table
 style="background-color: rgb(192, 192, 192); width: 35%; text-align: left;"
 cols="2" border="1">
        <tbody>
          <tr>
            <td style="text-align: left; vertical-align: middle;"
 rowspan="1">
            <div style="text-align: left;">
            <center>
            <pre>/***************************************************************************</pre>
            <pre><br></pre>
            <div style="text-align: left;">
            <pre>&nbsp; Convert the color PROMs into a more useable format.</pre>
            <pre><br>&nbsp; Bagman has two 32 bytes palette PROMs, connected to the RGB output this</pre>
            <pre>&nbsp; way:</pre>
            </div>
            <div style="text-align: left;">
            <pre><br>&nbsp; bit 7 -- 220 ohm resistor&nbsp; -- \</pre>
            <pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -- 470 ohm resistor&nbsp; -- | -- 470 ohm pulldown resistor -- BLUE</pre>
            <pre><br></pre>
            <pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -- 220 ohm resistor&nbsp; -- \</pre>
            <pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -- 470 ohm resistor&nbsp; -- | -- 470 ohm pulldown resistor -- GREEN</pre>
            <pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -- 1&nbsp; kohm resistor&nbsp; -- /</pre>
            <pre><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -- 220 ohm resistor&nbsp; -- \</pre>
            <pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -- 470 ohm resistor&nbsp; -- | -- 470 ohm pulldown resistor -- RED</pre>
            <pre>&nbsp; bit 0 -- 1&nbsp; kohm resistor&nbsp; -- /</pre>
            </div>
            <br>
***************************************************************************/<br>
            </center>
            </div>
            </td>
          </tr>
        </tbody>
      </table>
      <br>
      <div style="text-align: left;">Good. I don't know anything about
video
hardware, but I can understand that each byte has 3 groups of bits
which define different intensities for red, green and blue. Actually
it's 2 bits for blue, 3 for green and 3 for red, in that order: BB GGG
RRR. So 00 111 111 would be the RGB triplet 255,255,0. Which is the
yellow box (R1C1). Which is the hex value 3F ^_^<br>
      <br>
Of course, you don't have 8bit precision for each color channel. You
have 3 bit precision for red and green, and only 2 bit precision for
blue. Each bit activates a different resistor which gives out a
different intensity. MAME can convert to RGB values knowing the
relations of the resistors, well that's a bit too much for me. Instead
I looked what was the 8 bit value coming from the 2-3 bit values. This
is the table (bits in binary, value in decimal): <br>
      <br>
      <table
 style="background-color: rgb(204, 204, 204); width: 250px; text-align: left; margin-left: auto; margin-right: auto;"
 border="1" cellspacing="2" cellpadding="2">
        <tbody>
          <tr>
            <td
 style="vertical-align: top; font-weight: bold; width: 50px;">2
bits<br>
            </td>
            <td
 style="vertical-align: top; font-weight: bold; width: 50px;">8
bits<br>
            </td>
            <td
 style="vertical-align: top; font-weight: bold; width: 50px;"><br>
            </td>
            <td
 style="vertical-align: top; font-weight: bold; width: 50px;">3
bit<br>
            </td>
            <td
 style="vertical-align: top; font-weight: bold; width: 50px;">8
bit<br>
            </td>
          </tr>
          <tr>
            <td style="vertical-align: top; width: 50px;">00<br>
            </td>
            <td style="vertical-align: top; width: 50px;">000<br>
            </td>
            <td style="vertical-align: top; width: 50px;"><br>
            </td>
            <td style="vertical-align: top; width: 50px;">000<br>
            </td>
            <td style="vertical-align: top; width: 50px;">000<br>
            </td>
          </tr>
          <tr>
            <td style="vertical-align: top; width: 50px;">01<br>
            </td>
            <td style="vertical-align: top; width: 50px;">079<br>
            </td>
            <td style="vertical-align: top; width: 50px;"><br>
            </td>
            <td style="vertical-align: top; width: 50px;">001<br>
            </td>
            <td style="vertical-align: top; width: 50px;">033<br>
            </td>
          </tr>
          <tr>
            <td style="vertical-align: top; width: 50px;">10<br>
            </td>
            <td style="vertical-align: top; width: 50px;">168<br>
            </td>
            <td style="vertical-align: top; width: 50px;"><br>
            </td>
            <td style="vertical-align: top; width: 50px;">010<br>
            </td>
            <td style="vertical-align: top; width: 50px;">071<br>
            </td>
          </tr>
          <tr>
            <td style="vertical-align: top; width: 50px;">11<br>
            </td>
            <td style="vertical-align: top; width: 50px;">247<br>
            </td>
            <td style="vertical-align: top; width: 50px;"><br>
            </td>
            <td style="vertical-align: top; width: 50px;">011<br>
            </td>
            <td style="vertical-align: top; width: 50px;">104<br>
            </td>
          </tr>
          <tr>
            <td style="vertical-align: top; width: 50px;"><br>
            </td>
            <td style="vertical-align: top; width: 50px;"><br>
            </td>
            <td style="vertical-align: top; width: 50px;"><br>
            </td>
            <td style="vertical-align: top; width: 50px;">100<br>
            </td>
            <td style="vertical-align: top; width: 50px;">151<br>
            </td>
          </tr>
          <tr>
            <td style="vertical-align: top; width: 50px;"><br>
            </td>
            <td style="vertical-align: top; width: 50px;"><br>
            </td>
            <td style="vertical-align: top; width: 50px;"><br>
            </td>
            <td style="vertical-align: top; width: 50px;">101<br>
            </td>
            <td style="vertical-align: top; width: 50px;">184<br>
            </td>
          </tr>
          <tr>
            <td style="vertical-align: top; width: 50px;"><br>
            </td>
            <td style="vertical-align: top; width: 50px;"><br>
            </td>
            <td style="vertical-align: top; width: 50px;"><br>
            </td>
            <td style="vertical-align: top; width: 50px;">110<br>
            </td>
            <td style="vertical-align: top; width: 50px;">222<br>
            </td>
          </tr>
          <tr>
            <td style="vertical-align: top; width: 50px;"><br>
            </td>
            <td style="vertical-align: top; width: 50px;"><br>
            </td>
            <td style="vertical-align: top; width: 50px;"><br>
            </td>
            <td style="vertical-align: top; width: 50px;">111<br>
            </td>
            <td style="vertical-align: top; width: 50px;">255<br>
            </td>
          </tr>
        </tbody>
      </table>
      <br>
      <br>
Knowing this, it was easy detecting the remaining bytes just knowing
the color. Two of them are actually in the second prom (6331-1.3r).
Finally I built this table:<br>
      <br>
<!-- La tabla siguiente fue generada por el Asistente para el ayudante de Internet de Microsoft Excel. --><!-- ------------------------- --><!-- INICIO DE CONVERSI&Oacute;N --><!-- ------------------------- -->
      <table
 style="background-color: rgb(204, 204, 204); text-align: left; margin-left: auto; margin-right: auto;"
 border="1">
        <tbody>
          <tr valign="bottom">
            <td align="left"><font face="Arial"><b>Pos in File</b></font></td>
            <td align="left"><font face="Arial"><b>Pos in Pic</b></font></td>
            <td align="left" style=""><font face="Arial"><b>Hex</b></font></td>
            <td align="left" style=""><font face="Arial"><b>bb ggg rrr</b></font></td>
            <td align="left" style=""><font face="Arial"><b>RGB</b></font></td>
            <td align="left" style=""><font face="Arial"><b>color</b></font></td>
          </tr>
          <tr valign="bottom">
            <td align="right"><font face="Arial">p-5</font></td>
            <td align="left"><font face="Arial">R1C1</font></td>
            <td align="left" style=""><font face="Arial">0x3F</font></td>
            <td align="left" style=""><font face="Arial">00 111 111</font></td>
            <td align="left" style=""><font face="Arial">255,255,000</font></td>
            <td align="left" style=""><font face="Arial">yellow</font></td>
          </tr>
          <tr valign="bottom">
            <td align="right"><font face="Arial">p-9</font></td>
            <td align="left"><font face="Arial">R2C1</font></td>
            <td align="left" style=""><font face="Arial">0x38</font></td>
            <td align="left" style=""><font face="Arial">00 111 000</font></td>
            <td align="left" style=""><font face="Arial">000,255,000</font></td>
            <td align="left" style=""><font face="Arial">bright green</font></td>
          </tr>
          <tr valign="bottom">
            <td align="right"><font face="Arial">p-13</font></td>
            <td style="text-align: left;"><font face="Arial">R3C1</font></td>
            <td align="left" style=""><font face="Arial">0xC0</font></td>
            <td align="left" style=""><font face="Arial">11 000 000</font></td>
            <td align="left" style=""><font face="Arial">000,000,247</font></td>
            <td align="left" style=""><font face="Arial">dark blue</font></td>
          </tr>
          <tr valign="bottom">
            <td align="right"><font face="Arial">p-17</font></td>
            <td align="left"><font face="Arial">R1C2</font></td>
            <td align="left" style=""><font face="Arial">0xC7</font></td>
            <td align="left" style=""><font face="Arial">11 000 111</font></td>
            <td align="left" style=""><font face="Arial">255,000,247</font></td>
            <td align="left" style=""><font face="Arial">pink</font></td>
          </tr>
          <tr valign="bottom">
            <td align="right"><font face="Arial">p-21</font></td>
            <td align="left"><font face="Arial">R2C2</font></td>
            <td align="left"><font face="Arial">0xE8</font></td>
            <td align="left"><font face="Arial">11 101 000</font></td>
            <td align="left"><font face="Arial">000,184,247</font></td>
            <td align="left"><font face="Arial">light blue</font></td>
          </tr>
          <tr valign="bottom">
            <td align="right"><font face="Arial">p-25</font></td>
            <td align="left"><font face="Arial">R3C2</font></td>
            <td align="left"><font face="Arial">0x07</font></td>
            <td align="left"><font face="Arial">00 000 111</font></td>
            <td align="left"><font face="Arial">255,000,000</font></td>
            <td align="left"><font face="Arial">red</font></td>
          </tr>
          <tr valign="bottom">
            <td align="right"><font face="Arial">p-29</font></td>
            <td align="left"><font face="Arial">R1C3</font></td>
            <td align="left"><font face="Arial">0x58</font></td>
            <td align="left"><font face="Arial">01 011 000</font></td>
            <td align="left"><font face="Arial">000,104,079</font></td>
            <td align="left"><font face="Arial">dark green</font></td>
          </tr>
          <tr valign="bottom">
            <td align="right"><font face="Arial">r-1</font></td>
            <td align="left"><font face="Arial">R2C3</font></td>
            <td align="left"><font face="Arial">0x13</font></td>
            <td align="left"><font face="Arial">00 010 011</font></td>
            <td align="left"><font face="Arial">104,071,000</font></td>
            <td align="left"><font face="Arial">brown</font></td>
          </tr>
          <tr valign="bottom">
            <td align="right"><font face="Arial">r-5</font></td>
            <td align="left"><font face="Arial">R3C3</font></td>
            <td align="left"><font face="Arial">0xD3</font></td>
            <td align="left"><font face="Arial">11 010 011</font></td>
            <td align="left"><font face="Arial">104,071,247</font></td>
            <td align="left"><font face="Arial">blue</font></td>
          </tr>
        </tbody>
      </table>
<!-- ------------------------- --><!-- FIN DE CONVERSI&Oacute;N --><!-- ------------------------- -->
      <br>
      <br>
I hope it's clear enough. My research was done! Now I only had to
decide which colours I wanted to use. It was a bit tricky because I
couldn't use just any value, only 4 possible ones for the blue channel
and 8 possible ones for red and green. After some playing with PSP and
several mistakes I came up with the following table:<br>
      <br>
<!-- La tabla siguiente fue generada por el Asistente para el ayudante de Internet de Microsoft Excel. --><!-- ------------------------- --><!-- INICIO DE CONVERSI&Oacute;N --><!-- ------------------------- -->
      <table
 style="background-color: rgb(204, 204, 204); text-align: left; margin-left: auto; margin-right: auto;"
 border="1">
        <tbody>
          <tr valign="bottom">
            <td style="background-color: rgb(204, 204, 204);"
 align="left"><font face="Arial"><b>Pos in Pic</b></font></td>
            <td align="left"><font face="Arial"><b>Hex</b></font></td>
            <td align="left" style=""><font face="Arial"><b>bb ggg rrr</b></font></td>
            <td align="left" style=""><font face="Arial"><b>RGB</b></font></td>
            <td align="left" style=""><font face="Arial"><b>color</b></font></td>
          </tr>
          <tr valign="bottom">
            <td align="left"><font face="Arial">R1C1</font></td>
            <td align="left"><font face="Arial">0x07</font></td>
            <td align="left"><font face="Arial">00 000 111</font></td>
            <td align="left"><font face="Arial">255,000,000</font></td>
            <td align="left"><font face="Arial">bright red</font></td>
          </tr>
          <tr valign="bottom">
            <td align="left"><font face="Arial">R2C1</font></td>
            <td align="left" style=""><font face="Arial">0x38</font></td>
            <td align="left" style=""><font face="Arial">00 111 000</font></td>
            <td align="left" style=""><font face="Arial">000,255,000</font></td>
            <td align="left" style=""><font face="Arial">bright green</font></td>
          </tr>
          <tr valign="bottom">
            <td align="left"><font face="Arial">R3C1</font></td>
            <td align="left" style=""><font face="Arial">0xC0</font></td>
            <td align="left" style=""><font face="Arial">11 000 000</font></td>
            <td align="left" style=""><font face="Arial">000,000,247</font></td>
            <td align="left" style=""><font face="Arial">dark blue</font></td>
          </tr>
          <tr valign="bottom">
            <td align="left"><font face="Arial">R1C2</font></td>
            <td style="text-align: left;"><font face="Arial">0xC7</font></td>
            <td align="left" style=""><font face="Arial">11 000 111</font></td>
            <td align="left" style=""><font face="Arial">255,000,247</font></td>
            <td align="left" style=""><font face="Arial">pink</font></td>
          </tr>
          <tr valign="bottom">
            <td align="left"><font face="Arial">R2C2</font></td>
            <td align="left"><font face="Arial">0xE8</font></td>
            <td align="left"><font face="Arial">11 101 000</font></td>
            <td align="left"><font face="Arial">000,184,247</font></td>
            <td align="left"><font face="Arial">light blue</font></td>
          </tr>
          <tr valign="bottom">
            <td align="left"><font face="Arial">R3C2</font></td>
            <td align="left"><font face="Arial">0x04</font></td>
            <td align="left"><font face="Arial">00 000 100</font></td>
            <td align="left"><font face="Arial">151,000,000</font></td>
            <td align="left"><font face="Arial">dark red</font></td>
          </tr>
          <tr valign="bottom">
            <td align="left"><font face="Arial">R1C3</font></td>
            <td align="left"><font face="Arial">0x20</font></td>
            <td align="left"><font face="Arial">00 100 000</font></td>
            <td align="left"><font face="Arial">000,151,000</font></td>
            <td align="left"><font face="Arial">dark green</font></td>
          </tr>
          <tr valign="bottom">
            <td align="left"><font face="Arial">R2C3</font></td>
            <td align="left"><font face="Arial">0x67</font></td>
            <td align="left"><font face="Arial">01 100 111</font></td>
            <td align="left"><font face="Arial">255,151,079</font></td>
            <td align="left"><font face="Arial">light brown</font></td>
          </tr>
          <tr valign="bottom">
            <td align="left"><font face="Arial">R3C3</font></td>
            <td align="left"><font face="Arial">0x5C</font></td>
            <td align="left"><font face="Arial">01 011 100</font></td>
            <td align="left"><font face="Arial">151,104,079</font></td>
            <td align="left"><font face="Arial">dark brown</font></td>
          </tr>
        </tbody>
      </table>
<!-- ------------------------- --><!-- FIN DE CONVERSI&Oacute;N --><!-- ------------------------- -->
      <font size="-1"><i><br>
      </i></font><br>
So I simply replaced the corresponding bytes with the new value.
Ta-daaaa! My 20 years old frustration is gone. I have now a Pickin'
playable by someone with color perception problems ^_^<br>
      <br>
      <table border="1" cols="2"
 style="background-color: rgb(192, 192, 192); width: 35%; text-align: left; margin-left: auto; margin-right: auto;">
        <tbody>
          <tr>
            <td rowspan="1">
            <center><br>
            <img style="width: 224px; height: 256px;"
 alt="Pickin's third demo with altered colors"
 title="Pickin's third demo with altered colors"
 src="pickinx.png"><br>
            <br>
            </center>
            </td>
          </tr>
        </tbody>
      </table>
      <br>
      </div>
      </center>
You can download the already altered proms here:<br>
      <a href="pickin_altered_proms.zip">Pickin'
Altered PROMS (274 bytes</a><a
 href="pickin_altered_proms.zip">)</a><br>
      <br>
My advice is to keep them away from your precious clean MAME set. Make
a folder called pickin and put the two proms there. MAME reads first
uncompressed roms, so as long as you are cautious to not pass a rom
manager by there, you'll have no problem.<br>
      <br>
I know that for some people this was kinda silly, I know I'm not
Einstein, but I wanted to tell the whole tale, and maybe encourage
people into rom hacking. It was not really important how I did it, it
was relatively easy (for a first time hack). The important thing is
that I got rid of a 20 years old frustration ^_^<br>
      <br>
Pi.<br>
      <br>
      <br>
      <small><span style="font-style: italic;">Last changed 2004-02-26</span></small></td>
    </tr>
  </tbody>
</table>
<br>
</div>
<small><span style="font-style: italic;"></span></small><br>
</body>
</html>
